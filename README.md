# Box for Root

[![ID](https://img.shields.io/badge/id-blue.svg?style=for-the-badge)](docs/index_id.md) [![EN](https://img.shields.io/badge/en-blue.svg?style=for-the-badge)](docs/index_en.md) [![ZH](https://img.shields.io/badge/zh-blue.svg?style=for-the-badge)](docs/index_zh.md)

<h1 align="center">
  <img src="https://github.com/taamarin/box_for_magisk/blob/master/docs/box.svg" alt="BOX" width="200">
  <br>BOX<br>
</h1>
<h4 align="center">Transparent Proxy for Android (Root)</h4>

<div align="center">
  <a href="https://github.com/taamarin/box_for_magisk/releases">
    <img src="https://img.shields.io/github/downloads/taamarin/box_for_magisk/total.svg?style=for-the-badge" alt="Releases">
  </a>
  <a href="#">
    <img src="https://img.shields.io/badge/Android-3DDC84?style=for-the-badge&logo=android&logoColor=white" alt="Android">
  </a>
</div>

## Introduction
`Box for Root` (BFR) æ˜¯ä¸€ä¸ªä¸“ä¸º [Magisk](https://github.com/topjohnwu/Magisk), [KernelSU](https://github.com/tiann/KernelSU), [APatch](https://github.com/bmax121/APatch) ä¼˜åŒ–çš„é€æ˜ä»£ç†æ¨¡å—ã€‚

### ğŸŒŸ Sing-box ä¸“ç”¨åˆ†æ”¯
å½“å‰åˆ†æ”¯æ˜¯ **sing-box ä¸“ç”¨ä¼˜åŒ–ç‰ˆæœ¬**ï¼Œä¸“æ³¨äºæä¾›é«˜æ€§èƒ½çš„ `sing-box` ä»£ç†æœåŠ¡ã€‚è¯¥ç‰ˆæœ¬ç§»é™¤äº†å…¶ä»–ä»£ç†å·¥å…·æ”¯æŒï¼Œä¸“é—¨ä¸ºsing-boxè¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ï¼Œæä¾›æ›´å¥½çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚

ğŸ“– **[æŸ¥çœ‹ Sing-box åˆ†æ”¯è¯¦ç»†è¯´æ˜ â†’](README-SINGBOX.md)**

### åˆ†æ”¯å¯¹æ¯”
- **ä¸»åˆ†æ”¯** (`master`): æ”¯æŒå¤šç§ä»£ç†æ ¸å¿ƒ (clash, xray, v2fly, hysteria, sing-box)
- **Sing-box åˆ†æ”¯** (`sing-box`): ä»…æ”¯æŒ sing-boxï¼Œä½†æä¾›æ›´å¥½çš„æ€§èƒ½å’Œä¸“ä¸šåŠŸèƒ½

## Features

### ğŸ¯ Sing-box ä¸“ç”¨ç‰¹æ€§
- ğŸš€ **ä¸“ä¸º sing-box ä¼˜åŒ–**ï¼šç§»é™¤å…¶ä»–æ ¸å¿ƒï¼Œä¸“æ³¨æ€§èƒ½æå‡
- ğŸ¨ **Zashboard é›†æˆ**ï¼šä¸“ä¸šçš„ Web ç®¡ç†ç•Œé¢
- ğŸ”§ **å¢å¼ºç½‘ç»œæ¨¡å¼**ï¼šåˆ›æ–°çš„ `enhance` æ¨¡å¼ï¼Œç»“åˆ REDIRECT å’Œ TPROXY ä¼˜åŠ¿
- âš¡ **æ€§èƒ½ä¼˜åŒ–**ï¼šcgroup é…ç½®ã€CPU ç»‘å®šã€å†…å­˜ç®¡ç†
- ğŸ¤– **å®Œæ•´è‡ªåŠ¨åŒ–**ï¼šGitHub Actions è‡ªåŠ¨æ›´æ–°å’Œæ„å»ºç³»ç»Ÿ
- ğŸ“± **æ— ç¼é›†æˆ**ï¼šå®Œç¾æ”¯æŒ Magisk, KernelSU, å’Œ APatch
- ğŸ›¡ï¸ **æ™ºèƒ½åˆ†æµ**ï¼šä¼˜åŒ–çš„è§„åˆ™ç®¡ç†å’Œæµé‡å¤„ç†

### ğŸ”„ åˆ†æ”¯åˆ‡æ¢æŒ‡å—
```bash
# åˆ‡æ¢åˆ° sing-box ä¸“ç”¨åˆ†æ”¯
git checkout sing-box

# åˆ‡æ¢å›ä¸»åˆ†æ”¯
git checkout master
```

**æ¨èä½¿ç”¨åœºæ™¯**ï¼š
- **Sing-box åˆ†æ”¯**ï¼šè¿½æ±‚é«˜æ€§èƒ½ã€ç¨³å®šæ€§ï¼Œåªä½¿ç”¨ sing-box æ ¸å¿ƒ
- **ä¸»åˆ†æ”¯**ï¼šéœ€è¦å¤šæ ¸å¿ƒæ”¯æŒï¼Œå…¼å®¹æ€§ä¼˜å…ˆ

## Apk Manager
You can use the **BFR Manager** app (optional) to manage Box for Root on your device.
[Download BFR Manager](https://github.com/taamarin/box.manager)
> âš ï¸ If you receive continuous notifications, open Magisk Manager, navigate to SuperUser, search for `BoxForRoot`, and disable logs and notifications.

## Module Directory
The core files of the module are stored in the following directories:
- `MODDIR=/data/adb/box`
- `MODLOG=/data/adb/box/run`
- `SETTINGS=/data/adb/box/settings.ini`
> âš ï¸ Before editing the `settings.ini` file located at `/data/adb/box/settings.ini`, ensure that BFR is turned off to avoid configuration issues.

## Manage Service Start/Stop
The following core services are collectively referred to as **BFR**. By default, the BFR service auto-starts after a system boot. You can manage the service through Magisk/KernelSU Manager App, with the service start taking a few seconds, and stopping it taking effect immediately.

### To start the service:
```bash
su -c /data/adb/box/scripts/box.service start && su -c /data/adb/box/scripts/box.iptables enable
```
### To stop the service:
```bash
su -c /data/adb/box/scripts/box.iptables disable && su -c /data/adb/box/scripts/box.service stop
```

## Here are some additional instructions:
- When modifying any of the core configuration files, ensure that the tproxy-related configurations match the definitions in the **/data/adb/box/settings.ini** file.
- If your device has a public IP address, you can add that IP address to the internal network in the **/data/adb/box/scripts/box.iptables** file to prevent loopback traffic.
- The logs for the BFM service can be found in the directory **/data/adb/box/run**.
- Please note that modifying these files requires appropriate permissions. Make sure to carefully follow the instructions and validate any changes made to the configuration files.

You can run the following command to get other related operating instructions:
```bash
  su -c /data/adb/box/scripts/box.tool
  # usage: {check|geosub|geox|subs|upkernel|upxui|upyq|upcurl|reload|all}
  su -c /data/adb/box/scripts/box.service
  # usage: $0 {start|stop|restart|status|cron|kcron}
  su -c /data/adb/box/scripts/box.iptables
  # usage: $0 {enable|disable|renew}
```

## ğŸ¤– GitHub Actions è‡ªåŠ¨åŒ–ç³»ç»Ÿ

æœ¬é¡¹ç›®é…ç½®äº†å®Œæ•´çš„GitHub Actionsè‡ªåŠ¨åŒ–ç³»ç»Ÿï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

### ğŸ”„ è‡ªåŠ¨æ›´æ–°
- **sing-boxæ ¸å¿ƒè‡ªåŠ¨æ›´æ–°**: æ¯å¤©æ£€æŸ¥å¹¶æ›´æ–°sing-boxåˆ°æœ€æ–°ç‰ˆæœ¬
- **Zashboard UIè‡ªåŠ¨æ›´æ–°**: è‡ªåŠ¨æ›´æ–°Webç®¡ç†ç•Œé¢åˆ°æœ€æ–°ç‰ˆæœ¬
- **å¤šæ¶æ„æ”¯æŒ**: è‡ªåŠ¨ä¸‹è½½amd64, arm64, armv7æ¶æ„çš„äºŒè¿›åˆ¶æ–‡ä»¶
- **æ™ºèƒ½ç‰ˆæœ¬ç®¡ç†**: è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶å’Œè‡ªåŠ¨ç‰ˆæœ¬é€’å¢

### ğŸ“¦ è‡ªåŠ¨æ‰“åŒ…
- **è‡ªåŠ¨æ„å»º**: ä»£ç å˜æ›´æ—¶è‡ªåŠ¨æ„å»ºMagiskæ¨¡å—
- **ç‰ˆæœ¬å‘å¸ƒ**: è‡ªåŠ¨åˆ›å»ºGitHub Releaseå’Œå¼€å‘ç‰ˆæœ¬
- **æ–‡ä»¶æ ¡éªŒ**: è‡ªåŠ¨ç”ŸæˆSHA256å’ŒMD5æ ¡éªŒæ–‡ä»¶
- **è¯¦ç»†æ—¥å¿—**: è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬æ›´æ–°æ—¥å¿—

### ğŸ§ª æŒç»­é›†æˆ
- **é…ç½®éªŒè¯**: è‡ªåŠ¨éªŒè¯JSONé…ç½®æ–‡ä»¶æ ¼å¼
- **è„šæœ¬æµ‹è¯•**: Shellè„šæœ¬è¯­æ³•å’ŒåŠŸèƒ½æ£€æŸ¥
- **ç»“æ„éªŒè¯**: æ¨¡å—ç»“æ„å®Œæ•´æ€§æ£€æŸ¥
- **é›†æˆæµ‹è¯•**: ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•

### ğŸ“Š ç›‘æ§å’Œé€šçŸ¥
- **æ„å»ºçŠ¶æ€**: å®æ—¶ç›‘æ§æ„å»ºå’Œæµ‹è¯•çŠ¶æ€
- **é”™è¯¯æŠ¥å‘Š**: è‡ªåŠ¨ç”Ÿæˆæ•…éšœæŠ¥å‘Šå’Œå»ºè®®
- **æ€§èƒ½ç›‘æ§**: æ„å»ºæ—¶é—´å’Œèµ„æºä½¿ç”¨ç›‘æ§

è¯¦ç»†ä½¿ç”¨è¯´æ˜è¯·å‚è€ƒ [GitHub Actionsæ–‡æ¡£](.github/README.md)

## ğŸ¨ Webç®¡ç†ç•Œé¢

é›†æˆäº†Zashboard Webç®¡ç†ç•Œé¢ï¼Œæä¾›ç›´è§‚çš„å›¾å½¢åŒ–ç®¡ç†ï¼š

- **è®¿é—®åœ°å€**: `http://127.0.0.1:9090`
- **å®æ—¶ç›‘æ§**: è¿æ¥çŠ¶æ€ã€æµé‡ç»Ÿè®¡ã€æ€§èƒ½æŒ‡æ ‡
- **é…ç½®ç®¡ç†**: å¯è§†åŒ–é…ç½®ç¼–è¾‘å’ŒéªŒè¯
- **æ—¥å¿—æŸ¥çœ‹**: å®æ—¶æ—¥å¿—ç›‘æ§å’Œåˆ†æ
- **è§„åˆ™ç®¡ç†**: åˆ†æµè§„åˆ™å¯è§†åŒ–ç®¡ç†

### é…ç½®æ–‡ä»¶
- **sing-boxé…ç½®**: `/data/adb/box/sing-box/config.json`
- **Zashboardé…ç½®**: `/data/adb/box/sing-box/zashboard-config.json`
- **æ¨¡å—è®¾ç½®**: `/data/adb/box/settings.ini`

## Uninstall
Remove the module from `Magisk/KernelSU/APatch Manager` and run the following command to wipe the data:
```bash
su -c rm -rf /data/adb/box
su -c rm -rf /data/adb/service.d/box_service.sh
su -c rm -rf /data/adb/modules/box_for_root
```

## Credits
- [CHIZI-0618/box4magisk](https://github.com/CHIZI-0618/box4magisk) for the original Box for Magisk module.

## License
This project is licensed under the GPL-3.0 license - see the [LICENSE](https://github.com/taamarin/box_for_magisk/blob/master/LICENSE) file for details.
