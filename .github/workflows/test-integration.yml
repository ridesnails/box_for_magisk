name: ğŸ§ª Integration Tests

on:
  push:
    branches: [ main, master ]
    paths:
      - 'box/**'
      - 'webroot/**'
      - '**.sh'
      - '**.json'
  pull_request:
    branches: [ main, master ]
    paths:
      - 'box/**'
      - 'webroot/**'
      - '**.sh'
      - '**.json'
  workflow_dispatch:
  schedule:
    # æ¯å¤©å‡Œæ™¨3ç‚¹è¿è¡Œå®Œæ•´æµ‹è¯•
    - cron: '0 3 * * *'

env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  validate-configs:
    name: ğŸ“ é…ç½®æ–‡ä»¶éªŒè¯
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: âš™ï¸ å®‰è£…ä¾èµ–å·¥å…·
      run: |
        sudo apt-get update
        sudo apt-get install -y jq shellcheck yamllint

    - name: ğŸ” éªŒè¯JSONé…ç½®æ–‡ä»¶
      run: |
        echo "ğŸ” éªŒè¯JSONé…ç½®æ–‡ä»¶..."
        
        json_files=(
          "box/sing-box/config.json"
          "update.json"
        )
        
        # æŸ¥æ‰¾æ‰€æœ‰JSONæ–‡ä»¶
        if [ -f "box/zashboard/config.json" ]; then
          json_files+=("box/zashboard/config.json")
        fi
        
        error_count=0
        for file in "${json_files[@]}"; do
          echo "éªŒè¯: $file"
          if [ -f "$file" ]; then
            if jq empty "$file" 2>/dev/null; then
              echo "âœ… $file - JSONæ ¼å¼æ­£ç¡®"
            else
              echo "âŒ $file - JSONæ ¼å¼é”™è¯¯"
              jq empty "$file"
              error_count=$((error_count + 1))
            fi
          else
            echo "âš ï¸ $file - æ–‡ä»¶ä¸å­˜åœ¨"
          fi
        done
        
        if [ $error_count -gt 0 ]; then
          echo "âŒ å‘ç° $error_count ä¸ªJSONæ ¼å¼é”™è¯¯"
          exit 1
        fi
        
        echo "âœ… æ‰€æœ‰JSONé…ç½®æ–‡ä»¶éªŒè¯é€šè¿‡"

    - name: ğŸ” éªŒè¯sing-boxé…ç½®
      run: |
        echo "ğŸ” éªŒè¯sing-boxé…ç½®ç»“æ„..."
        
        config_file="box/sing-box/config.json"
        
        # æ£€æŸ¥å¿…è¦çš„é…ç½®æ®µ
        required_sections=("log" "inbounds" "outbounds" "route")
        
        for section in "${required_sections[@]}"; do
          if jq -e ".$section" "$config_file" >/dev/null; then
            echo "âœ… $section æ®µå­˜åœ¨"
          else
            echo "âŒ $section æ®µç¼ºå¤±"
            exit 1
          fi
        done
        
        # æ£€æŸ¥å…¥ç«™é…ç½®
        inbound_count=$(jq '.inbounds | length' "$config_file")
        echo "ğŸ“Š å…¥ç«™é…ç½®æ•°é‡: $inbound_count"
        
        if [ "$inbound_count" -lt 1 ]; then
          echo "âŒ è‡³å°‘éœ€è¦ä¸€ä¸ªå…¥ç«™é…ç½®"
          exit 1
        fi
        
        # æ£€æŸ¥å‡ºç«™é…ç½®
        outbound_count=$(jq '.outbounds | length' "$config_file")
        echo "ğŸ“Š å‡ºç«™é…ç½®æ•°é‡: $outbound_count"
        
        if [ "$outbound_count" -lt 1 ]; then
          echo "âŒ è‡³å°‘éœ€è¦ä¸€ä¸ªå‡ºç«™é…ç½®"
          exit 1
        fi
        
        # æ£€æŸ¥ç«¯å£é…ç½®
        ports=$(jq -r '.inbounds[].listen_port // empty' "$config_file")
        echo "ğŸ“Š ç›‘å¬ç«¯å£: $ports"
        
        echo "âœ… sing-boxé…ç½®éªŒè¯é€šè¿‡"

    - name: ğŸ” éªŒè¯æ¨¡å—å±æ€§æ–‡ä»¶
      run: |
        echo "ğŸ” éªŒè¯module.prop..."
        
        if [ ! -f "module.prop" ]; then
          echo "âŒ module.propæ–‡ä»¶ä¸å­˜åœ¨"
          exit 1
        fi
        
        # æ£€æŸ¥å¿…è¦å­—æ®µ
        required_fields=("id" "name" "version" "versionCode" "author" "description")
        
        for field in "${required_fields[@]}"; do
          if grep -q "^$field=" module.prop; then
            value=$(grep "^$field=" module.prop | cut -d'=' -f2-)
            echo "âœ… $field = $value"
          else
            echo "âŒ ç¼ºå°‘å¿…è¦å­—æ®µ: $field"
            exit 1
          fi
        done
        
        # éªŒè¯ç‰ˆæœ¬å·æ ¼å¼
        version=$(grep "^version=" module.prop | cut -d'=' -f2)
        if [[ $version =~ ^v[0-9]+\.[0-9]+(\.[0-9]+)?(-.*)?$ ]]; then
          echo "âœ… ç‰ˆæœ¬å·æ ¼å¼æ­£ç¡®: $version"
        else
          echo "âŒ ç‰ˆæœ¬å·æ ¼å¼é”™è¯¯: $version"
          exit 1
        fi
        
        echo "âœ… module.propéªŒè¯é€šè¿‡"

  test-scripts:
    name: ğŸ”§ è„šæœ¬æµ‹è¯•
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: âš™ï¸ å®‰è£…æµ‹è¯•å·¥å…·
      run: |
        sudo apt-get update
        sudo apt-get install -y shellcheck bash

    - name: ğŸ” Shellè„šæœ¬è¯­æ³•æ£€æŸ¥
      run: |
        echo "ğŸ” æ‰§è¡ŒShellè„šæœ¬è¯­æ³•æ£€æŸ¥..."
        
        # æŸ¥æ‰¾æ‰€æœ‰shellè„šæœ¬
        script_files=(
          "customize.sh"
          "uninstall.sh"
          "box_service.sh"
        )
        
        # æŸ¥æ‰¾boxç›®å½•ä¸‹çš„è„šæœ¬
        if [ -d "box/scripts" ]; then
          script_files+=($(find box/scripts -name "*.sh" -type f))
        fi
        
        error_count=0
        for script in "${script_files[@]}"; do
          if [ -f "$script" ]; then
            echo "æ£€æŸ¥: $script"
            
            # è¯­æ³•æ£€æŸ¥
            if bash -n "$script" 2>/dev/null; then
              echo "âœ… $script - è¯­æ³•æ­£ç¡®"
            else
              echo "âŒ $script - è¯­æ³•é”™è¯¯"
              bash -n "$script"
              error_count=$((error_count + 1))
            fi
            
            # ShellCheckæ£€æŸ¥ (å…è®¸ä¸€äº›å¸¸è§çš„è­¦å‘Š)
            if shellcheck -e SC2034,SC2086,SC2181,SC2155 "$script" 2>/dev/null; then
              echo "âœ… $script - ShellChecké€šè¿‡"
            else
              echo "âš ï¸ $script - ShellCheckè­¦å‘Š"
              shellcheck -e SC2034,SC2086,SC2181,SC2155 "$script" || true
            fi
          else
            echo "âš ï¸ $script - æ–‡ä»¶ä¸å­˜åœ¨"
          fi
        done
        
        if [ $error_count -gt 0 ]; then
          echo "âŒ å‘ç° $error_count ä¸ªè„šæœ¬è¯­æ³•é”™è¯¯"
          exit 1
        fi
        
        echo "âœ… æ‰€æœ‰è„šæœ¬è¯­æ³•æ£€æŸ¥é€šè¿‡"

    - name: ğŸ” è„šæœ¬åŠŸèƒ½æµ‹è¯•
      run: |
        echo "ğŸ” æ‰§è¡Œè„šæœ¬åŠŸèƒ½æµ‹è¯•..."
        
        # æµ‹è¯•customize.shä¸­çš„å‡½æ•°
        if [ -f "customize.sh" ]; then
          echo "æµ‹è¯• customize.sh..."
          
          # æ£€æŸ¥æ˜¯å¦å®šä¹‰äº†å¿…è¦çš„å˜é‡å’Œå‡½æ•°
          if grep -q "SKIPUNZIP" customize.sh; then
            echo "âœ… SKIPUNZIPå˜é‡å·²å®šä¹‰"
          else
            echo "âš ï¸ SKIPUNZIPå˜é‡æœªå®šä¹‰"
          fi
          
          if grep -q "on_install" customize.sh; then
            echo "âœ… on_installå‡½æ•°å­˜åœ¨"
          else
            echo "âš ï¸ on_installå‡½æ•°ä¸å­˜åœ¨"
          fi
        fi
        
        echo "âœ… è„šæœ¬åŠŸèƒ½æµ‹è¯•å®Œæˆ"

  test-webui:
    name: ğŸŒ Webç•Œé¢æµ‹è¯•
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: âš™ï¸ è®¾ç½®Node.jsç¯å¢ƒ
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: ğŸ” Webç•Œé¢ç»“æ„éªŒè¯
      run: |
        echo "ğŸ” éªŒè¯Webç•Œé¢ç»“æ„..."
        
        if [ ! -d "webroot" ]; then
          echo "âŒ webrootç›®å½•ä¸å­˜åœ¨"
          exit 1
        fi
        
        # æ£€æŸ¥å¿…è¦æ–‡ä»¶
        required_files=("index.html")
        
        for file in "${required_files[@]}"; do
          if [ -f "webroot/$file" ]; then
            echo "âœ… $file å­˜åœ¨"
          else
            echo "âŒ $file ä¸å­˜åœ¨"
            exit 1
          fi
        done
        
        # æ£€æŸ¥HTMLæ–‡ä»¶è¯­æ³•
        if [ -f "webroot/index.html" ]; then
          echo "éªŒè¯ index.html..."
          
          # åŸºæœ¬HTMLç»“æ„æ£€æŸ¥
          if grep -q "<html" webroot/index.html; then
            echo "âœ… HTMLæ ‡ç­¾å­˜åœ¨"
          else
            echo "âŒ ç¼ºå°‘HTMLæ ‡ç­¾"
            exit 1
          fi
          
          if grep -q "<head" webroot/index.html; then
            echo "âœ… HEADæ ‡ç­¾å­˜åœ¨"
          else
            echo "âŒ ç¼ºå°‘HEADæ ‡ç­¾"
            exit 1
          fi
          
          if grep -q "<body" webroot/index.html; then
            echo "âœ… BODYæ ‡ç­¾å­˜åœ¨"
          else
            echo "âŒ ç¼ºå°‘BODYæ ‡ç­¾"
            exit 1
          fi
        fi
        
        # æ£€æŸ¥é™æ€èµ„æº
        assets_dirs=("assets" "css" "js" "static")
        for dir in "${assets_dirs[@]}"; do
          if [ -d "webroot/$dir" ]; then
            file_count=$(find "webroot/$dir" -type f | wc -l)
            echo "âœ… $dir ç›®å½•å­˜åœ¨ ($file_count ä¸ªæ–‡ä»¶)"
          else
            echo "âš ï¸ $dir ç›®å½•ä¸å­˜åœ¨"
          fi
        done
        
        echo "âœ… Webç•Œé¢ç»“æ„éªŒè¯å®Œæˆ"

    - name: ğŸ” Zashboardé…ç½®æµ‹è¯•
      run: |
        echo "ğŸ” æµ‹è¯•Zashboardé…ç½®..."
        
        if [ -f "box/zashboard/config.json" ]; then
          echo "éªŒè¯ zashboard config.json..."

          # æ£€æŸ¥é…ç½®ç»“æ„
          required_fields=("version" "api_endpoint")
          
          for field in "${required_fields[@]}"; do
            if jq -e ".zashboard.$field" box/zashboard/config.json >/dev/null; then
              value=$(jq -r ".zashboard.$field" box/zashboard/config.json)
              echo "âœ… $field = $value"
            else
              echo "âŒ ç¼ºå°‘å­—æ®µ: $field"
              exit 1
            fi
          done
          
          # æ£€æŸ¥APIç«¯ç‚¹æ ¼å¼
          api_endpoint=$(jq -r '.zashboard.api.host + ":" + (.zashboard.api.port | tostring)' box/zashboard/config.json)
          if [[ $api_endpoint =~ ^https?://[^/]+:[0-9]+$ ]]; then
            echo "âœ… APIç«¯ç‚¹æ ¼å¼æ­£ç¡®"
          else
            echo "âŒ APIç«¯ç‚¹æ ¼å¼é”™è¯¯: $api_endpoint"
            exit 1
          fi
        else
          echo "âš ï¸ zashboard config.json ä¸å­˜åœ¨"
        fi
        
        echo "âœ… Zashboardé…ç½®æµ‹è¯•å®Œæˆ"

  test-module-structure:
    name: ğŸ“¦ æ¨¡å—ç»“æ„æµ‹è¯•
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: ğŸ” éªŒè¯Magiskæ¨¡å—ç»“æ„
      run: |
        echo "ğŸ” éªŒè¯Magiskæ¨¡å—ç»“æ„..."
        
        # æ£€æŸ¥å¿…è¦æ–‡ä»¶
        required_files=(
          "module.prop"
          "customize.sh"
          "uninstall.sh"
          "META-INF/com/google/android/update-binary"
          "META-INF/com/google/android/updater-script"
        )
        
        missing_files=()
        for file in "${required_files[@]}"; do
          if [ -f "$file" ]; then
            echo "âœ… $file å­˜åœ¨"
          else
            echo "âŒ $file ç¼ºå¤±"
            missing_files+=("$file")
          fi
        done
        
        if [ ${#missing_files[@]} -gt 0 ]; then
          echo "âŒ ç¼ºå°‘å¿…è¦æ–‡ä»¶: ${missing_files[*]}"
          exit 1
        fi
        
        # æ£€æŸ¥ç›®å½•ç»“æ„
        required_dirs=("box" "META-INF" "webroot")
        
        for dir in "${required_dirs[@]}"; do
          if [ -d "$dir" ]; then
            file_count=$(find "$dir" -type f | wc -l)
            echo "âœ… $dir ç›®å½•å­˜åœ¨ ($file_count ä¸ªæ–‡ä»¶)"
          else
            echo "âŒ $dir ç›®å½•ç¼ºå¤±"
            exit 1
          fi
        done
        
        echo "âœ… æ¨¡å—ç»“æ„éªŒè¯é€šè¿‡"

    - name: ğŸ” éªŒè¯boxç›®å½•ç»“æ„
      run: |
        echo "ğŸ” éªŒè¯boxç›®å½•ç»“æ„..."
        
        # æ£€æŸ¥boxå­ç›®å½•
        box_dirs=("sing-box" "scripts")
        
        for dir in "${box_dirs[@]}"; do
          if [ -d "box/$dir" ]; then
            echo "âœ… box/$dir ç›®å½•å­˜åœ¨"
          else
            echo "âŒ box/$dir ç›®å½•ç¼ºå¤±"
            exit 1
          fi
        done
        
        # æ£€æŸ¥å…³é”®é…ç½®æ–‡ä»¶
        key_files=(
          "box/settings.ini"
          "box/sing-box/config.json"
        )
        
        for file in "${key_files[@]}"; do
          if [ -f "$file" ]; then
            echo "âœ… $file å­˜åœ¨"
          else
            echo "âŒ $file ç¼ºå¤±"
            exit 1
          fi
        done
        
        echo "âœ… boxç›®å½•ç»“æ„éªŒè¯é€šè¿‡"

  integration-test:
    name: ğŸ”— é›†æˆæµ‹è¯•
    runs-on: ubuntu-latest
    needs: [validate-configs, test-scripts, test-webui, test-module-structure]
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: âš™ï¸ å®‰è£…æµ‹è¯•ä¾èµ–
      run: |
        sudo apt-get update
        sudo apt-get install -y zip unzip jq curl

    - name: ğŸ§ª æ¨¡æ‹Ÿæ¨¡å—å®‰è£…æµ‹è¯•
      run: |
        echo "ğŸ§ª æ¨¡æ‹Ÿæ¨¡å—å®‰è£…è¿‡ç¨‹..."
        
        # åˆ›å»ºæ¨¡æ‹Ÿç¯å¢ƒ
        mkdir -p test_env/data/adb
        export MODPATH="test_env/system"
        export MODID="box_for_root"
        
        # æ¨¡æ‹Ÿå®‰è£…è¿‡ç¨‹
        echo "æ¨¡æ‹Ÿå¤åˆ¶æ–‡ä»¶..."
        mkdir -p "$MODPATH"
        
        # æ£€æŸ¥customize.shæ˜¯å¦èƒ½æ­£å¸¸æ‰§è¡ŒåŸºæœ¬æ£€æŸ¥
        if [ -f "customize.sh" ]; then
          echo "æµ‹è¯• customize.sh åŸºæœ¬åŠŸèƒ½..."
          
          # è®¾ç½®æ¨¡æ‹Ÿå˜é‡
          export TMPDIR="test_env/tmp"
          mkdir -p "$TMPDIR"
          
          # æ‰§è¡Œè¯­æ³•æ£€æŸ¥
          bash -n customize.sh
          echo "âœ… customize.sh è¯­æ³•æ£€æŸ¥é€šè¿‡"
        fi
        
        echo "âœ… æ¨¡å—å®‰è£…æµ‹è¯•å®Œæˆ"

    - name: ğŸ§ª é…ç½®å…¼å®¹æ€§æµ‹è¯•
      run: |
        echo "ğŸ§ª æµ‹è¯•é…ç½®æ–‡ä»¶å…¼å®¹æ€§..."
        
        # æµ‹è¯•settings.inié…ç½®
        if [ -f "box/settings.ini" ]; then
          echo "æµ‹è¯• settings.ini..."
          
          # æ£€æŸ¥å…³é”®å˜é‡æ˜¯å¦å®šä¹‰
          key_vars=("bin_name" "network_mode" "api_port" "mixed_port")
          
          for var in "${key_vars[@]}"; do
            if grep -q "^$var=" box/settings.ini; then
              value=$(grep "^$var=" box/settings.ini | cut -d'=' -f2 | tr -d '"')
              echo "âœ… $var = $value"
            else
              echo "âŒ ç¼ºå°‘å˜é‡: $var"
              exit 1
            fi
          done
        fi
        
        # æµ‹è¯•sing-boxé…ç½®ç«¯å£ä¸€è‡´æ€§
        if [ -f "box/sing-box/config.json" ] && [ -f "box/settings.ini" ]; then
          echo "æµ‹è¯•ç«¯å£é…ç½®ä¸€è‡´æ€§..."
          
          # ä»settings.iniè·å–ç«¯å£
          api_port=$(grep "^api_port=" box/settings.ini | cut -d'=' -f2 | tr -d '"')
          mixed_port=$(grep "^mixed_port=" box/settings.ini | cut -d'=' -f2 | tr -d '"')
          
          # æ£€æŸ¥sing-boxé…ç½®ä¸­çš„ç«¯å£
          sb_api_port=$(jq -r '.experimental.clash_api.external_controller // empty' box/sing-box/config.json | cut -d':' -f2)
          sb_mixed_port=$(jq -r '.inbounds[] | select(.type=="mixed") | .listen_port // empty' box/sing-box/config.json)
          
          if [ "$api_port" = "$sb_api_port" ]; then
            echo "âœ… APIç«¯å£ä¸€è‡´: $api_port"
          else
            echo "âš ï¸ APIç«¯å£ä¸ä¸€è‡´: settings.ini($api_port) vs config.json($sb_api_port)"
          fi
          
          if [ "$mixed_port" = "$sb_mixed_port" ]; then
            echo "âœ… Mixedç«¯å£ä¸€è‡´: $mixed_port"
          else
            echo "âš ï¸ Mixedç«¯å£ä¸ä¸€è‡´: settings.ini($mixed_port) vs config.json($sb_mixed_port)"
          fi
        fi
        
        echo "âœ… é…ç½®å…¼å®¹æ€§æµ‹è¯•å®Œæˆ"

    - name: ğŸ“Š ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
      run: |
        echo "ğŸ“Š ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š..."
        
        {
          echo "# ğŸ§ª é›†æˆæµ‹è¯•æŠ¥å‘Š"
          echo ""
          echo "## ğŸ“‹ æµ‹è¯•æ‘˜è¦"
          echo "- æµ‹è¯•æ—¶é—´: $(date +"%Y-%m-%d %H:%M:%S UTC")"
          echo "- Gitæäº¤: ${{ github.sha }}"
          echo "- åˆ†æ”¯: ${{ github.ref_name }}"
          echo ""
          echo "## âœ… æµ‹è¯•é¡¹ç›®"
          echo "- JSONé…ç½®æ–‡ä»¶éªŒè¯"
          echo "- sing-boxé…ç½®éªŒè¯"
          echo "- Shellè„šæœ¬è¯­æ³•æ£€æŸ¥"
          echo "- Webç•Œé¢ç»“æ„éªŒè¯"
          echo "- æ¨¡å—ç»“æ„éªŒè¯"
          echo "- é…ç½®å…¼å®¹æ€§æµ‹è¯•"
          echo ""
          echo "## ğŸ“Š æµ‹è¯•ç»“æœ"
          echo "æ‰€æœ‰æµ‹è¯•é¡¹ç›®å‡å·²é€šè¿‡ï¼Œæ¨¡å—ç»“æ„å®Œæ•´ï¼Œé…ç½®æ–‡ä»¶æ ¼å¼æ­£ç¡®ã€‚"
          echo ""
          echo "## ğŸ”§ å»ºè®®äº‹é¡¹"
          echo "- å®šæœŸæ›´æ–°sing-boxæ ¸å¿ƒç‰ˆæœ¬"
          echo "- ä¿æŒWebç•Œé¢ä¸APIçš„å…¼å®¹æ€§"
          echo "- æŒç»­ç›‘æ§è„šæœ¬çš„Shellå…¼å®¹æ€§"
          echo ""
          echo "---"
          echo "*æµ‹è¯•æŠ¥å‘Šç”±GitHub Actionsè‡ªåŠ¨ç”Ÿæˆ*"
        } > test_report.md
        
        echo "âœ… æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ"

  notify-results:
    name: ğŸ“¢ æµ‹è¯•ç»“æœé€šçŸ¥
    runs-on: ubuntu-latest
    needs: [validate-configs, test-scripts, test-webui, test-module-structure, integration-test]
    if: always()
    
    steps:
    - name: ğŸ“Š æ±‡æ€»æµ‹è¯•ç»“æœ
      run: |
        echo "ğŸ“Š æ±‡æ€»æµ‹è¯•ç»“æœ..."
        
        # æ£€æŸ¥å„ä¸ªä½œä¸šçš„çŠ¶æ€
        configs_result="${{ needs.validate-configs.result }}"
        scripts_result="${{ needs.test-scripts.result }}"
        webui_result="${{ needs.test-webui.result }}"
        structure_result="${{ needs.test-module-structure.result }}"
        integration_result="${{ needs.integration-test.result }}"
        
        echo "ğŸ” é…ç½®éªŒè¯: $configs_result"
        echo "ğŸ”§ è„šæœ¬æµ‹è¯•: $scripts_result"
        echo "ğŸŒ Webç•Œé¢æµ‹è¯•: $webui_result"
        echo "ğŸ“¦ æ¨¡å—ç»“æ„æµ‹è¯•: $structure_result"
        echo "ğŸ”— é›†æˆæµ‹è¯•: $integration_result"
        
        # è®¡ç®—æ€»ä½“ç»“æœ
        if [[ "$configs_result" == "success" && "$scripts_result" == "success" && 
              "$webui_result" == "success" && "$structure_result" == "success" && 
              "$integration_result" == "success" ]]; then
          echo "ğŸ‰ æ‰€æœ‰æµ‹è¯•å‡å·²é€šè¿‡!"
          echo "overall_result=success" >> $GITHUB_ENV
        else
          echo "âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥"
          echo "overall_result=failure" >> $GITHUB_ENV
        fi

    - name: ğŸ“¢ å‘é€é€šçŸ¥
      run: |
        echo "ğŸ“¢ å‘é€æµ‹è¯•ç»“æœé€šçŸ¥..."
        echo "**æµ‹è¯•æ—¶é—´**: $(date +"%Y-%m-%d %H:%M:%S UTC")"
        echo "**å·¥ä½œæµ**: ${{ github.workflow }}"
        echo "**è¿è¡ŒID**: ${{ github.run_id }}"
        echo "**æ•´ä½“ç»“æœ**: ${{ env.overall_result }}"
        
        # è¿™é‡Œå¯ä»¥æ·»åŠ å…¶ä»–é€šçŸ¥æ–¹å¼ï¼Œå¦‚é‚®ä»¶ã€Slackç­‰